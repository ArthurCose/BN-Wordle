const t=0,e=1,s=2,i=3,o=4,r=5,h=7,n=8,l=9,a={ArrowUp:t,ArrowDown:e,ArrowLeft:s,ArrowRight:i,KeyZ:o,KeyX:r,Enter:6,KeyA:h,KeyS:n};class c{#t=[];#e=[];#s=[];#i=[];constructor(){document.addEventListener("keydown",(t=>{const e=a[t.code];null!=e&&(this.simulateRepeat(e),this.simulatePress(e))})),document.addEventListener("keyup",(t=>{const e=a[t.code];null!=e&&this.simulateRelease(e)}))}simulatePress(t){this.#s[t]||(this.#t[t]=!0,this.#s[t]=!0)}simulateRepeat(t){this.#s[t]&&(this.#e[t]=!0)}simulateRelease(t){null!=t&&this.#s[t]&&(this.#i[t]=!0,this.#s[t]=!1)}justPressed(t){return 1==this.#t[t]}justRepeated(t){return 1==this.#e[t]}justReleased(t){return 1==this.#i[t]}isDown(t){return 1==this.#s[t]}flush(){this.#t=[],this.#i=[],this.#e=[]}}const u=Math.floor(2.5);class d{#o=!1;#r=0;#h=null;#n=[];cursorPos={x:2,y:2};onExit=()=>{};onReturnShape=t=>{};setShapes(t){this.#n=t}selectShape(t){this.#h=t}#l(t,e,s){const i=(e,s)=>{const i=this.getShape(e,s);return i&&i!=t&&i.color==t.color};return i(e-1,s)||i(e+1,s)||i(e,s-1)||i(e,s+1)}isValid(){for(let t=0;t<5;t++)for(let e=0;e<5;e++){const s=this.getShape(e,t);if(s&&this.#l(s,e,t))return!1}return!0}#a(){const t=this.getShape(this.cursorPos.x,this.cursorPos.y);if(!t)return null;const e=this.#n.indexOf(t);return this.#n.splice(e,1),this.#h=t,this.cursorPos.x=t.x,this.cursorPos.y=t.y,t}#c(){if(!this.#h)return;for(let t=0;t<5;t++)this.#h.existsAt(t,-1)&&(this.#h.y+=1),this.#h.existsAt(t,5)&&(this.#h.y-=1);for(let t=0;t<5;t++)this.#h.existsAt(-1,t)&&(this.#h.x+=1),this.#h.existsAt(5,t)&&(this.#h.x-=1);this.cursorPos.x=this.#h.x,this.cursorPos.y=this.#h.y}#u(){if(!this.#h)return!1;for(let t=0;t<5;t++)for(let e=0;e<5;e++){if(!this.#h.existsAt(t,e))continue;if(this.getShape(t,e))return!1}return this.#n.push(this.#h),this.#h=null,!0}getShape(t,e){return this.#n.find((s=>s.existsAt(t,e)))}giveFocus(){this.#o=!0,this.#r=0}removeFocus(){this.#o=!1}update(l,a){this.#r+=a;const c=l.justPressed(s)||l.justRepeated(s),u=l.justPressed(i)||l.justRepeated(i),d=l.justPressed(t)||l.justRepeated(t),p=l.justPressed(e)||l.justRepeated(e);if(c&&(this.cursorPos.x-=1),u&&(this.cursorPos.x+=1),d&&(this.cursorPos.y-=1),p&&(this.cursorPos.y+=1),!this.#h&&this.cursorPos.x>=5&&this.onExit(this.cursorPos),this.cursorPos.x=Math.max(0,this.cursorPos.x),this.cursorPos.x=Math.min(4,this.cursorPos.x),this.cursorPos.y=Math.max(0,this.cursorPos.y),this.cursorPos.y=Math.min(4,this.cursorPos.y),this.#h){if(this.#h.x=this.cursorPos.x,this.#h.y=this.cursorPos.y,l.justPressed(h)&&this.#h.rotateLeft(),l.justPressed(n)&&this.#h.rotate(),this.#c(),l.justPressed(o))this.#u();else if(l.justPressed(r)){const t=this.#h;this.#h=null,this.#n=this.#n.filter((e=>e!=t)),this.onReturnShape(t)}}else l.justPressed(o)?this.#a():l.justPressed(r)&&this.onExit(this.cursorPos)}render(t){t.fillStyle="#889EB3",t.fillRect(14,24,112,112),t.fillStyle="#124D7F",t.fillRect(20,30,100,100);for(let e=0;e<5;e++)for(let s=0;s<5;s++){const i=this.getShape(e,s);i&&(t.fillStyle=i.color,t.fillRect(20+20*e,30+20*s,20,20)),this.#h&&this.#h.existsAt(e,s)&&(t.globalAlpha=.75,t.fillStyle=this.#h.color,t.fillRect(20+20*e,30+20*s,20,20),t.globalAlpha=1)}if(t.fillStyle="#00000033",t.beginPath(),t.moveTo(20,70),t.lineTo(120,70),t.lineTo(120,80),t.lineTo(120,90),t.lineTo(20,90),t.fill(),this.#o){const{x:e,y:s}=this.cursorPos;t.strokeStyle="#E02828",t.strokeRect(20+20*e+.5,30+20*s+.5,19,19);const i=this.getShape(e,s);!this.#h&&i&&(t.font="16px bn6-bold",t.textBaseline="top",t.fillText(i.letter,20+20*e+6,30+20*s+3))}}}function p(t){return Math.floor(Math.random()*t)}function f(t){return t[p(t.length)]}class x{#o=!1;#d=0;#n=[];cursorIndex=0;onRun=()=>{};onExit=t=>{};onSelection=t=>{};giveFocus(){this.#o=!0,this.#d=0}removeFocus(){this.#o=!1,this.#d=0}setShapes(t){t.forEach((t=>{t.x=Math.floor(2.5),t.y=Math.floor(2.5),t.rotation=p(4)})),this.#n=t}addShape(t){t.x=Math.floor(2.5),t.y=Math.floor(2.5),this.#n.push(t)}update(i,r){if(this.#d+=r,i.justPressed(s))return void this.onExit(this.cursorIndex);const h=i.justPressed(t)||i.justRepeated(t),n=i.justPressed(e)||i.justRepeated(e);if(h&&(this.cursorIndex-=1),n&&(this.cursorIndex+=1),this.cursorIndex=Math.max(0,this.cursorIndex),this.cursorIndex=Math.min(this.#n.length,this.cursorIndex),i.justPressed(o))if(this.cursorIndex<this.#n.length){const[t]=this.#n.splice(this.cursorIndex,1);this.onSelection(t)}else this.onRun()}render(t){t.font="16px bn6-bold",t.textBaseline="top";const e=15;for(let s=0;s<this.#n.length;s++){const i=this.#n[s],o=140,r=30+20*s;t.fillStyle="#889EB3",t.fillRect(o-2,r-2,30,19),t.fillStyle="#124D7F",t.fillRect(o,r,26,e),t.fillStyle=i.color;for(let e=0;e<5;e++)for(let s=0;s<5;s++)i.existsAt(e,s)&&t.fillRect(o+3*e+11,r+3*s,3,3);t.fillStyle="white",t.fillText(i.letter,o+1,r+1)}{const s=140,i=30+20*this.#n.length;t.fillStyle="#889EB3",t.fillRect(s-2,i-2,30,19),t.fillStyle="lime",t.fillRect(s,i,26,e),t.fillStyle="white",t.fillText("RUN",s+1,i+1)}if(this.#o){const s=131+Math.sin(16*this.#d),i=30+20*this.cursorIndex;t.strokeStyle="green",t.fillStyle="lime",t.beginPath(),t.moveTo(s,i),t.lineTo(s+8,i+7.5),t.lineTo(s,i+e),t.closePath(),t.fill(),t.stroke()}}}class S{#p=0;#f;#x;#S;#y;constructor(t,e){this.#f=t}onSuccess=()=>{};onExit=()=>{};setWord(t){this.#x=t}giveFocus(){this.#p=0,this.#S=null}removeFocus(){this.#p=0}#g(){this.#S="";for(let t=0;t<5;t++){const e=this.#f.getShape(t,u);this.#S+=e?e.letter:"?"}this.#y=this.#f.isValid()}update(t,e){this.#p=Math.min(1,this.#p+e/2);const s=t.justPressed(o),i=t.justPressed(r);(s||i)&&1==this.#p&&this.onExit(),this.#S||1!=this.#p||this.#g()}#P(t){t.beginPath();const e=100*this.#p;t.moveTo(20,70),t.lineTo(20+e,70),t.lineTo(20+e,80),t.lineTo(20+e,90),t.lineTo(20,90),t.fill()}#E(t,e,s){for(let i=0;i<5*this.#p-.5;i++){const o=this.#f.getShape(i,u);t.font="16px bn6-bold",t.fillText(o?o.letter:"?",20+20*i+6+e,30+20*u+3+s)}}render(t){t.fillStyle="#ffff0066",this.#P(t),this.#E(t,1,1),this.#p<1?t.fillStyle="black":this.#S==this.#x?t.fillStyle=this.#y?"lime":"orange":t.fillStyle="red",this.#E(t,0,0)}}class y{#A=[{binding:h,x:0,y:1,w:2,h:1},{binding:n,x:8,y:1,w:2,h:1},{binding:s,x:1,y:4,w:1,h:1},{binding:i,x:3,y:4,w:1,h:1},{binding:t,x:2,y:3,w:1,h:1},{binding:e,x:2,y:5,w:1,h:1},{binding:o,x:7,y:3,w:1,h:1},{binding:r,x:6,y:4,w:1,h:1}];#b;#m=[];#R;constructor(t,e){this.#b=t,this.#R=e,t.addEventListener("touchstart",(t=>{this.#T(t)})),t.addEventListener("touchmove",(t=>{this.#T(t)})),t.addEventListener("touchend",(t=>{this.#T(t)}))}#T(t){const e=this.#b,s=e.getBoundingClientRect(),i=[];for(const o of t.targetTouches){let t=(o.clientX-s.x)/s.width*e.width,r=(o.clientY-s.y)/s.height*e.height;t/=24,r=(r-160)/24;for(const e of this.#A)t>e.x&&r>e.y&&t<e.x+e.w&&r<e.y+e.h&&(i[e.binding]=!0)}for(let t=0;t<l;t++)this.#m[t]&&!i[t]?this.#R.simulateRelease(t):!this.#m[t]&&i[t]&&this.#R.simulatePress(t);this.#m=i}update(){for(let t=0;t<l;t++)this.#m[t]&&this.#R.simulatePress(t)}render(t){t.fillStyle="white";for(const e of this.#A)t.fillRect(24*e.x,160+24*e.y,24*e.w,24*e.h)}}const g=Math.floor(2.5);class P{#v=[];constructor(){this.color="",this.letter="",this.x=0,this.y=0,this.rotation=0;for(let t=0;t<25;t++)this.#v[t]=!1}isColumn(){let t=0;for(let e=0;e<5;e++)for(let s=0;s<5;s++){const i=5*e+s;if(this.#v[i]){if(s!=g)return!1;t++}}return t>1}rotate(){this.rotation+=1,this.rotation%=4}rotateLeft(){this.rotation-=1,this.rotation<0&&(this.rotation=3)}canSet(t,e){const s=this.getIndex(t,e);return s>=0&&s<25}set(t,e,s){const i=this.getIndex(t,e);this.#v[i]=s}existsAt(t,e){const s=this.getIndex(t,e);return 1==this.#v[s]}countBlocks(){let t=0;for(let e=0;e<this.#v.length;e++)this.#v[e]&&t++;return t}recalculateCenter(){const t={top:0,bottom:0,left:0,right:0},e=[];for(let s=0;s<5;s++)for(let i=0;i<5;i++){const o=5*s+i;if(!this.#v[o])continue;const r=i-g,h=s-g;r<t.left&&(t.left=r),h<t.top&&(t.top=h),r>t.right&&(t.right=r),h>t.bottom&&(t.bottom=h),e.push({x:r,y:h})}const s=(t.left+t.right)/2,i=(t.bottom+t.top)/2;e.sort(((t,e)=>Math.abs(s-t.x)+Math.abs(i-t.y)<Math.abs(s-e.x)+Math.abs(i-e.y)?-1:1));const o=e[0];this.x-=o.x,this.y-=o.y;const r=[...this.#v];for(let t=0;t<5;t++)for(let e=0;e<5;e++){let s=!1;const i=e+o.x,h=t+o.y;if(i>=0&&h>=0&&i<5&&h<5){const t=5*h+i;s=this.#v[t]}r[5*t+e]=s}this.#v=r}getIndex(t,e){let s,i;switch(t-=this.x,e-=this.y,this.rotation){case 0:s=t,i=e;break;case 1:s=e,i=g-t-2;break;case 2:s=g-t-2,i=g-e-2;break;case 3:s=g-e-2,i=t}return s+=g,i+=g,s<0||i<0||s>=5||i>=5?-1:5*i+s}}let E=["#DE1100","#D688C0","#2880D9","#19C000","#D8DA00","#D8D8D8"];function A(t){let e=[],s=[],i=function(){const t=[];for(;t.length<4;){const e=f(E);t.includes(e)||t.push(e)}return t}(),o=p(i.length);for(let r=0;r<5;r++){const h=new P;h.color=i[(r+o)%i.length],h.x=r,h.y=2,h.letter=t[r],h.set(h.x,h.y,!0),e.push(h),s.push({shape:h,x:h.x,y:h.y-1}),s.push({shape:h,x:h.x,y:h.y+1}),t[r]==t[r+1]&&(h.set(h.x+1,h.y,!0),r++,s.push({shape:h,x:h.x+1,y:h.y-1}),s.push({shape:h,x:h.x+1,y:h.y+1}))}const r=({shape:t,x:e,y:i})=>{s.push({shape:t,x:e-1,y:i}),s.push({shape:t,x:e+1,y:i}),s.push({shape:t,x:e,y:i-1}),s.push({shape:t,x:e,y:i+1})};function h(t,s,i){function o(s,i){const o=e.find((t=>t.existsAt(s,i)));return o&&o!=t&&o.color==t.color}return o(s-1,i)||o(s+1,i)||o(s,i-1)||o(s,i+1)}for(;s.length>0;){const t=s;s=[];for(const{shape:i,x:o,y:n}of t){if(o<0||n<0||o>=5||n>=5)continue;if(e.find((t=>t.existsAt(o,n))))continue;f([()=>{h(i,o,n)||i.countBlocks()>=4||!i.canSet(o,n)||(i.set(o,n,!0),r({shape:i,x:o,y:n}))},()=>{s.push({shape:i,x:o,y:n})}])()}}return e}var b=["ZENNY","CHIPS","CYBER","PANEL","COLOR","POINT","GAUGE","VIRUS","DRILL","SNEAK","HPMEM","BREAK","SHOES","HUMOR","TANGO","ARMOR","BLOCK","CHAUD","BARYL","GLIDE","PROTO","MAGIC","SKULL","SHARK","PHARO","METAL","JAPAN","SPARK","VIDEO","SHADE","COSMO","MEDDY","CHAOS","SPOUT","BLAST","JUDGE","ERASE","TENGU","BEAST","CACHE","KENDO","LASER","QUICK","STONE","STEAL","CLOUD","INVIS","POPUP","SWORD","BLADE","PUNCH","LANCE","GUARD","RECOV","ARROW","SPICE","SHAKE","PANIC","BATCH","SNAKE","QUAKE","DELTA","STAGE","BILLY","FISHY","RATTY","PUFFY","JELLY","BUNNY","POWIE","PENGI","VINEY","ALPHA","TOTEM","TWINS","KILBY","WALLA","BATTY","HANDI","ZOMON","BRUTE","HEADY","GOLEM"];const m=document.querySelector("canvas"),R=m.getContext("2d"),T=new class{#w=new x;#f=new d;#M=new S(this.#f);#A;#L=this.#w;#R=new c;constructor(t){this.#A=new y(t,this.#R);const e=f(b);this.#M.setWord(e),this.#w.setShapes(function(t){if(!Array.isArray(t))throw new TypeError("Expected an array, got "+typeof t);for(let e=(t=[...t]).length-1;e>0;e--){const s=Math.floor(Math.random()*(e+1));[t[e],t[s]]=[t[s],t[e]]}return t}(function(t){let e;do{e=A(t)}while(e.filter((t=>t.isColumn())).length>1);for(const t of e)t.recalculateCenter();return e}(e))),this.focusOn(this.#w),this.#w.onRun=()=>{this.focusOn(this.#M)},this.#w.onSelection=t=>{this.#f.cursorPos={x:Math.floor(2.5),y:Math.floor(2.5)},this.#f.selectShape(t),this.focusOn(this.#f)},this.#w.onExit=t=>{this.#f.cursorPos={x:4,y:t},this.focusOn(this.#f)},this.#f.onReturnShape=t=>{this.#w.addShape(t)},this.#f.onExit=t=>{this.#w.cursorIndex=t.y,this.focusOn(this.#w)},this.#M.onExit=()=>{this.focusOn(this.#w)}}focusOn(t){this.#L?.removeFocus(),this.#L=t,this.#R.flush(),t.giveFocus(),this.update(0)}update(t){this.#L.update(this.#R,t),this.#R.flush(),this.#A.update()}#I(){return window.innerHeight<window.innerWidth}render(t,e){this.#I()?t.height=160:(t.height=320,this.#A.render(e)),e.fillStyle="orange",e.fillRect(0,0,t.width,160),this.#f.render(e),this.#w.render(e),this.#M.render(e)}}(m);let v;function w(t){if(null==v)return v=t,void requestAnimationFrame(w);const e=(t-v)/1e3;v=t,T.update(e),T.render(m,R),requestAnimationFrame(w)}window.addEventListener("load",(function(){w(0)}));
//# sourceMappingURL=index.6e0f87ac.js.map
