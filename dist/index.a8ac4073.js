let e;const t={UP:0,DOWN:1,LEFT:2,RIGHT:3,A:4,B:5,START:6,L:7,R:8,SIZE:9},s={ArrowUp:t.UP,ArrowDown:t.DOWN,ArrowLeft:t.LEFT,ArrowRight:t.RIGHT,KeyZ:t.A,KeyX:t.B,Enter:t.START,KeyA:t.L,KeyS:t.R};class i{#e=[];#t=[];#s=[];#i=[];constructor(){document.addEventListener("keydown",e=>{let t=s[e.code];void 0!=t&&(this.simulateRepeat(t),this.simulatePress(t))}),document.addEventListener("keyup",e=>{let t=s[e.code];void 0!=t&&this.simulateRelease(t)})}simulatePress(e){this.#s[e]||(this.#e[e]=!0,this.#s[e]=!0)}simulateRepeat(e){this.#s[e]&&(this.#t[e]=!0)}simulateRelease(e){void 0!=e&&this.#s[e]&&(this.#i[e]=!0,this.#s[e]=!1)}justPressed(e){return!0==this.#e[e]}justRepeated(e){return!0==this.#t[e]}justReleased(e){return!0==this.#i[e]}isDown(e){return!0==this.#s[e]}flush(){this.#e=[],this.#i=[],this.#t=[]}}const h=Math.floor(2.5),r={BOARD:"darkorange",BORDER:"#889EB3",GRID_BACKGROUND:"#124D7F",GRID_CURSOR:"lime",GRID_CURSOR_LETTER:"#0006",LINE_SHADOW:"#00000033",PROCESSING_LETTER:"WHITE",CORRECT_LETTER:"lime",INCORRECT_LETTER:"red",INVALID_LETTER:"orange",INVENTORY_CURSOR_BORDER:"green",INVENTORY_CURSOR:"lime"};class o{#h=!1;#r=0;#o=null;#l=[];cursorPos={x:2,y:2};onExit=()=>{};onReturnShape=e=>{};setShapes(e){this.#l=e}selectShape(e){this.#o=e}#n(e,t,s){let i=(t,s)=>{let i=this.getShape(t,s);return i&&i!=e&&i.color==e.color};return i(t-1,s)||i(t+1,s)||i(t,s-1)||i(t,s+1)}isValid(){for(let e=0;e<5;e++)for(let t=0;t<5;t++){let s=this.getShape(t,e);if(s&&this.#n(s,t,e))return!1}return!0}#a(){let e=this.getShape(this.cursorPos.x,this.cursorPos.y);if(!e)return null;let t=this.#l.indexOf(e);return this.#l.splice(t,1),this.#o=e,this.cursorPos.x=e.x,this.cursorPos.y=e.y,e}#u(){if(this.#o){for(let e=0;e<5;e++)this.#o.existsAt(e,-1)&&(this.#o.y+=1),this.#o.existsAt(e,5)&&(this.#o.y-=1);for(let e=0;e<5;e++)this.#o.existsAt(-1,e)&&(this.#o.x+=1),this.#o.existsAt(5,e)&&(this.#o.x-=1);this.cursorPos.x=this.#o.x,this.cursorPos.y=this.#o.y}}#d(){if(!this.#o)return!1;for(let e=0;e<5;e++)for(let t=0;t<5;t++)if(this.#o.existsAt(e,t)&&this.getShape(e,t))return!1;return this.#l.push(this.#o),this.#o=null,!0}getShape(e,t){return this.#l.find(s=>s.existsAt(e,t))}giveFocus(){this.#h=!0,this.#r=0}removeFocus(){this.#h=!1}update(e,s){this.#r+=s;let i=e.justPressed(t.LEFT)||e.justRepeated(t.LEFT),h=e.justPressed(t.RIGHT)||e.justRepeated(t.RIGHT),r=e.justPressed(t.UP)||e.justRepeated(t.UP),o=e.justPressed(t.DOWN)||e.justRepeated(t.DOWN);if(i&&(this.cursorPos.x-=1),h&&(this.cursorPos.x+=1),r&&(this.cursorPos.y-=1),o&&(this.cursorPos.y+=1),!this.#o&&this.cursorPos.x>=5&&this.onExit(this.cursorPos),this.cursorPos.x=Math.max(0,this.cursorPos.x),this.cursorPos.x=Math.min(4,this.cursorPos.x),this.cursorPos.y=Math.max(0,this.cursorPos.y),this.cursorPos.y=Math.min(4,this.cursorPos.y),this.#o){if(this.#o.x=this.cursorPos.x,this.#o.y=this.cursorPos.y,e.justPressed(t.L)&&this.#o.rotateLeft(),e.justPressed(t.R)&&this.#o.rotate(),this.#u(),e.justPressed(t.A))this.#d();else if(e.justPressed(t.B)){let e=this.#o;this.#o=null,this.#l=this.#l.filter(t=>t!=e),this.onReturnShape(e)}}else e.justPressed(t.A)?this.#a():e.justPressed(t.B)&&this.onExit(this.cursorPos)}render(e){e.fillStyle=r.BORDER,e.fillRect(14,24,112,112),e.fillStyle=r.GRID_BACKGROUND,e.fillRect(20,30,100,100);for(let t=0;t<5;t++)for(let s=0;s<5;s++){let i=this.getShape(t,s);i&&(e.fillStyle=i.color,e.fillRect(20+20*t,30+20*s,20,20)),this.#o&&this.#o.existsAt(t,s)&&(e.globalAlpha=.75,e.fillStyle=this.#o.color,e.fillRect(20+20*t,30+20*s,20,20),e.globalAlpha=1)}if(e.fillStyle=r.LINE_SHADOW,e.beginPath(),e.moveTo(20,70),e.lineTo(120,70),e.lineTo(120,80),e.lineTo(120,90),e.lineTo(20,90),e.fill(),this.#h){let{x:t,y:s}=this.cursorPos;e.strokeStyle=r.GRID_CURSOR,e.strokeRect(20+20*t+.5,30+20*s+.5,19,19);let i=this.getShape(t,s);!this.#o&&i&&(e.fillStyle=r.GRID_CURSOR_LETTER,e.font="16px bn6-bold",e.textBaseline="top",e.fillText(i.letter,20+20*t+6,30+20*s+3))}}}function l(e){return Math.floor(Math.random()*e)}function n(e){return e[l(e.length)]}class a{#h=!1;#c=0;#l=[];cursorIndex=0;onRun=()=>{};onExit=e=>{};onSelection=e=>{};giveFocus(){this.#h=!0,this.#c=0}removeFocus(){this.#h=!1,this.#c=0}setShapes(e){e.forEach(e=>{e.x=Math.floor(2.5),e.y=Math.floor(2.5),e.rotation=l(4)}),this.#l=e}addShape(e){e.x=Math.floor(2.5),e.y=Math.floor(2.5),this.#l.push(e)}update(e,s){if(this.#c+=s,e.justPressed(t.LEFT)){this.onExit(this.cursorIndex);return}let i=e.justPressed(t.UP)||e.justRepeated(t.UP),h=e.justPressed(t.DOWN)||e.justRepeated(t.DOWN);if(i&&(this.cursorIndex-=1),h&&(this.cursorIndex+=1),this.cursorIndex=Math.max(0,this.cursorIndex),this.cursorIndex=Math.min(this.#l.length,this.cursorIndex),e.justPressed(t.A)){if(this.cursorIndex<this.#l.length){let[e]=this.#l.splice(this.cursorIndex,1);this.onSelection(e)}else this.onRun()}}render(e){e.font="16px bn6-bold",e.textBaseline="top";for(let t=0;t<this.#l.length;t++){let s=this.#l[t],i=30+20*t;e.fillStyle=r.BORDER,e.fillRect(138,i-2,30,19),e.fillStyle=r.GRID_BACKGROUND,e.fillRect(140,i,26,15),e.fillStyle=s.color;for(let t=0;t<5;t++)for(let h=0;h<5;h++)s.existsAt(t,h)&&e.fillRect(140+3*t+11,i+3*h,3,3);e.fillStyle="white",e.fillText(s.letter,141,i+1)}{let t=30+20*this.#l.length;e.fillStyle=r.BORDER,e.fillRect(138,t-2,30,19),e.fillStyle="lime",e.fillRect(140,t,26,15),e.fillStyle="white",e.fillText("RUN",141,t+1)}if(this.#h){let t=131+Math.sin(16*this.#c),s=30+20*this.cursorIndex;e.strokeStyle=r.INVENTORY_CURSOR_BORDER,e.fillStyle=r.INVENTORY_CURSOR,e.beginPath(),e.moveTo(t,s),e.lineTo(t+8,s+7.5),e.lineTo(t,s+15),e.closePath(),e.fill(),e.stroke()}}}class u{#p=0;#f;#S;#R;#x;constructor(e,t){this.#f=e}onSuccess=()=>{};onExit=()=>{};setWord(e){this.#S=e}giveFocus(){this.#p=0,this.#R=null}removeFocus(){this.#p=0}#E(){this.#R="";for(let e=0;e<5;e++){let t=this.#f.getShape(e,h);this.#R+=t?t.letter:"?"}this.#x=this.#f.isValid()}update(e,s){this.#p=Math.min(1,this.#p+s/2);let i=e.justPressed(t.A),h=e.justPressed(t.B);(i||h)&&1==this.#p&&this.onExit(),this.#R||1!=this.#p||this.#E()}#y(e){e.beginPath();let t=100*this.#p;e.moveTo(20,70),e.lineTo(20+t,70),e.lineTo(20+t,80),e.lineTo(20+t,90),e.lineTo(20,90),e.fill()}#g(e,t,s){for(let i=0;i<5*this.#p-.5;i++){let r=this.#f.getShape(i,h);e.font="16px bn6-bold",e.fillText(r?r.letter:"?",20+20*i+6+t,30+20*h+3+s)}}render(e){let t;e.fillStyle="#ffff0066",this.#y(e),t=this.#p<1?r.PROCESSING_LETTER:this.#R==this.#S?this.#x?r.CORRECT_LETTER:r.INVALID_LETTER:r.INCORRECT_LETTER,e.fillStyle=t,e.globalAlpha=.5,this.#g(e,1,1),e.fillStyle="black",e.globalAlpha=.5,this.#g(e,1,1),e.globalAlpha=1,e.fillStyle=t,this.#g(e,0,0)}}class d{#T=[{binding:t.L,x:0,y:1,w:2,h:1},{binding:t.R,x:8,y:1,w:2,h:1},{binding:t.LEFT,x:1,y:4,w:1,h:1},{binding:t.RIGHT,x:3,y:4,w:1,h:1},{binding:t.UP,x:2,y:3,w:1,h:1},{binding:t.DOWN,x:2,y:5,w:1,h:1},{binding:t.A,x:7,y:3,w:1,h:1},{binding:t.B,x:6,y:4,w:1,h:1}];#A;#P=[];#O;constructor(e,t){this.#A=e,this.#O=t,e.addEventListener("touchstart",e=>{this.#I(e)}),e.addEventListener("touchmove",e=>{this.#I(e)}),e.addEventListener("touchend",e=>{this.#I(e)})}#I(e){let s=this.#A,i=s.getBoundingClientRect(),h=[];for(let t of e.targetTouches){let e=(t.clientX-i.x)/i.width*s.width,r=(t.clientY-i.y)/i.height*s.height;for(let t of(e/=24,r=(r-160)/24,this.#T))e>t.x&&r>t.y&&e<t.x+t.w&&r<t.y+t.h&&(h[t.binding]=!0)}for(let e=0;e<t.SIZE;e++)this.#P[e]&&!h[e]?this.#O.simulateRelease(e):!this.#P[e]&&h[e]&&this.#O.simulatePress(e);this.#P=h}update(){for(let e=0;e<t.SIZE;e++)this.#P[e]&&this.#O.simulatePress(e)}render(e){for(let t of(e.fillStyle="white",this.#T))e.fillRect(24*t.x,160+24*t.y,24*t.w,24*t.h)}}const c=Math.floor(2.5);class p{#L=[];constructor(){this.color="",this.letter="",this.x=0,this.y=0,this.rotation=0;for(let e=0;e<25;e++)this.#L[e]=!1}isColumn(){let e=0;for(let t=0;t<5;t++)for(let s=0;s<5;s++){let i=5*t+s;if(this.#L[i]){if(s!=c)return!1;e++}}return e>1}rotate(){this.rotation+=1,this.rotation%=4}rotateLeft(){this.rotation-=1,this.rotation<0&&(this.rotation=3)}canSet(e,t){let s=this.getIndex(e,t);return s>=0&&s<25}set(e,t,s){let i=this.getIndex(e,t);this.#L[i]=s}existsAt(e,t){let s=this.getIndex(e,t);return!0==this.#L[s]}countBlocks(){let e=0;for(let t=0;t<this.#L.length;t++)this.#L[t]&&e++;return e}recalculateCenter(){let e={top:0,bottom:0,left:0,right:0},t=[];for(let s=0;s<5;s++)for(let i=0;i<5;i++){let h=5*s+i;if(!this.#L[h])continue;let r=i-c,o=s-c;r<e.left&&(e.left=r),o<e.top&&(e.top=o),r>e.right&&(e.right=r),o>e.bottom&&(e.bottom=o),t.push({x:r,y:o})}let s={x:(e.left+e.right)/2,y:(e.bottom+e.top)/2};t.sort((e,t)=>Math.abs(s.x-e.x)+Math.abs(s.y-e.y)<Math.abs(s.x-t.x)+Math.abs(s.y-t.y)?-1:1);let i=t[0];this.x-=i.x,this.y-=i.y;let h=[...this.#L];for(let e=0;e<5;e++)for(let t=0;t<5;t++){let s=!1,r=t+i.x,o=e+i.y;if(r>=0&&o>=0&&r<5&&o<5){let e=5*o+r;s=this.#L[e]}h[5*e+t]=s}this.#L=h}getIndex(e,t){let s,i;switch(e-=this.x,t-=this.y,this.rotation){case 0:s=e,i=t;break;case 1:s=t,i=c-e-2;break;case 2:s=c-e-2,i=c-t-2;break;case 3:s=c-t-2,i=e}return(s+=c,i+=c,s<0||i<0||s>=5||i>=5)?-1:5*i+s}}let f=["#DE1100","#D688C0","#2880D9","#19C000","#D8DA00","#D8D8D8"];var S=["ZENNY","CHIPS","CYBER","PANEL","COLOR","POINT","GAUGE","VIRUS","DRILL","SNEAK","HPMEM","BREAK","SHOES","HUMOR","TANGO","ARMOR","BLOCK","CHAUD","BARYL","GLIDE","PROTO","MAGIC","SKULL","SHARK","PHARO","METAL","JAPAN","SPARK","VIDEO","SHADE","COSMO","MEDDY","CHAOS","SPOUT","BLAST","JUDGE","ERASE","TENGU","BEAST","CACHE","KENDO","LASER","QUICK","STONE","STEAL","CLOUD","INVIS","POPUP","SWORD","BLADE","PUNCH","LANCE","GUARD","RECOV","ARROW","SPICE","SHAKE","PANIC","BATCH","SNAKE","QUAKE","DELTA","STAGE","BILLY","FISHY","RATTY","PUFFY","JELLY","BUNNY","POWIE","PENGI","VINEY","ALPHA","TOTEM","TWINS","KILBY","WALLA","BATTY","HANDI","ZOMON","BRUTE","HEADY","GOLEM"];class R{#b=new a;#f=new o;#m=new u(this.#f);#T;#D=this.#b;#O=new i;constructor(e){this.#T=new d(e,this.#O);let t=n(S);this.#m.setWord(t),this.#b.setShapes(function(e){if(!Array.isArray(e))throw TypeError(`Expected an array, got ${typeof e}`);e=[...e];for(let t=e.length-1;t>0;t--){let s=Math.floor(Math.random()*(t+1));[e[t],e[s]]=[e[s],e[t]]}return e}(function(e){let t;do t=function(e){let t=[],s=[],i=function(){let e=[];for(;e.length<4;){let t=n(f);e.includes(t)||e.push(t)}return e}(),h=l(i.length);for(let r=0;r<5;r++){let o=new p;o.color=i[(r+h)%i.length],o.x=r,o.y=2,o.letter=e[r],o.set(o.x,o.y,!0),t.push(o),s.push({shape:o,x:o.x,y:o.y-1}),s.push({shape:o,x:o.x,y:o.y+1}),e[r]==e[r+1]&&(o.set(o.x+1,o.y,!0),r++,s.push({shape:o,x:o.x+1,y:o.y-1}),s.push({shape:o,x:o.x+1,y:o.y+1}))}let r=({shape:e,x:t,y:i})=>{s.push({shape:e,x:t-1,y:i}),s.push({shape:e,x:t+1,y:i}),s.push({shape:e,x:t,y:i-1}),s.push({shape:e,x:t,y:i+1})};for(;s.length>0;){let e=s;for(let{shape:i,x:h,y:o}of(s=[],e))h<0||o<0||h>=5||o>=5||t.find(e=>e.existsAt(h,o))||n([()=>{!function(e,s,i){function h(s,i){let h=t.find(e=>e.existsAt(s,i));return h&&h!=e&&h.color==e.color}return h(s-1,i)||h(s+1,i)||h(s,i-1)||h(s,i+1)}(i,h,o)&&!(i.countBlocks()>=4)&&i.canSet(h,o)&&(i.set(h,o,!0),r({shape:i,x:h,y:o}))},()=>{s.push({shape:i,x:h,y:o})}])()}return t}(e);while(t.filter(e=>e.isColumn()).length>1)for(let e of t)e.recalculateCenter();return t}(t))),this.focusOn(this.#b),this.#b.onRun=()=>{this.focusOn(this.#m)},this.#b.onSelection=e=>{this.#f.cursorPos={x:Math.floor(2.5),y:Math.floor(2.5)},this.#f.selectShape(e),this.focusOn(this.#f)},this.#b.onExit=e=>{this.#f.cursorPos={x:4,y:e},this.focusOn(this.#f)},this.#f.onReturnShape=e=>{this.#b.addShape(e)},this.#f.onExit=e=>{this.#b.cursorIndex=e.y,this.focusOn(this.#b)},this.#m.onExit=()=>{this.focusOn(this.#b)}}focusOn(e){this.#D?.removeFocus(),this.#D=e,this.#O.flush(),e.giveFocus(),this.update(0)}update(e){this.#D.update(this.#O,e),this.#O.flush(),this.#T.update()}#N(){return window.innerHeight<window.innerWidth}render(e,t){this.#N()?e.height=160:(e.height=320,this.#T.render(t)),t.fillStyle=r.BOARD,t.fillRect(0,0,e.width,160),this.#f.render(t),this.#b.render(t),this.#m.render(t)}}const x=document.querySelector("canvas"),E=x.getContext("2d"),y=new R(x);window.addEventListener("load",function(){!function t(s){if(void 0==e){e=s,requestAnimationFrame(t);return}let i=(s-e)/1e3;e=s,y.update(i),y.render(x,E),requestAnimationFrame(t)}(0)});
//# sourceMappingURL=index.a8ac4073.js.map
